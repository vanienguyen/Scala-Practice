<!DOCTYPE html>
<html>
    <head>

        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css">

        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <link rel="stylesheet" href="/resources/demos/style.css">

        <style>

            #grandParentDiv {
                position: relative;
                overflow: hidden;
                background: transparent;
                width: 680px;
                height: 530px;
            }

            #parentDiv {
                position: fixed;
                float: top;
                width: auto;
                width: 650px;
                height: 400px;
                align-items: center;
                display: inline-block;
                align-items: center;
                justify-content: center;
            }

            #searchBar {
                position: fixed;
                display: block;
                align-items: center;
                justify-content: center;
            }

            #query, #searchButton {
                margin: 2px;
            }

            #searchResults {
                margin-top: 40px;
                display: flex;
            }

            #videoTitle {
                text-align: center;
                -moz-text-size-adjust: auto;
            }

            .viewCount {
                text-align: center;
                float: left;
            }

            #resizer {
                width: 10px;
                height: 10px;
                position: absolute;
                background: olivedrab;
                right: 0;
                bottom: 0;
                cursor: se-resize;
            }
        </style>
    </head>
    <body>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://apis.google.com/js/api.js"></script>

        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>

        <script>
          // This code loads the IFrame Player API code asynchronously.
          var tag = document.createElement('script');
          tag.src = "https://www.youtube.com/iframe_api";
          var firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          // This function creates an <iframe> (and YouTube player)
          // after the API code downloads.
          var player;
          var dataYT;

          function onYouTubeIframeAPIReady() {
              player = new YT.Player('player', {
                  height: "390",
                  width: "640",
                  videoId: 'M7lc1UVf-VE',
                  events: {
                      'onReady': onPlayerReady,
                      'onStateChange': onPlayerStateChange,
                  }
              });
          }

          // Create HTML element function
          function createElement(tag, id) {
              var element = document.createElement(tag);
              element.id = id;
              return element;
          }

          // Create grandParenetDiv and parentDiv
          var grandParentDiv = createElement('div', 'grandParentDiv');
          document.body.appendChild(grandParentDiv);

          var parentDiv = createElement("div", "parentDiv");
          grandParentDiv.append(parentDiv);

          // iFrame's initial width
          var iFrameInitWidth = parentDiv.offsetWidth - 10;

          // Create div for the iFrame
          var player = createElement("div", "player");
          parentDiv.append(player);

          // Create a div for search bar
          var searchBar = createElement("div", "searchBar");
          parentDiv.append(searchBar);
          searchBar.style.width = iFrameInitWidth + 'px';
          //searchBar.style.width = "100px";
          searchBar.className = "ui mini input";

          // Add query tag and search button
          var query = createElement("input", "query")
          query.placeholder = "Search...";
          searchBar.append(query);
          query.style.width = iFrameInitWidth/2 + 'px';

          var searchButton = createElement("button", "searchButton");
          searchButton.innerHTML = "Search";
          searchButton.className = "ui olive button" + ", " + "mini ui button" ;
          searchBar.append(searchButton);

          // Create a div to contain the search results
          var searchResults = createElement("div", "searchResults");
          parentDiv.append(searchResults);
          searchResults.style.width = iFrameInitWidth +'px';

          function searchVideo() {

              $.get("https://www.googleapis.com/youtube/v3/search", {
                      part: 'snippet,id',
                      q: document.getElementById("query").value,
                      type: 'video',
                      key: 'AIzaSyBY1d9RpLqmieVnW0UjQD2Vahs2thzDsBw'
                  },

                  // Display the search results
                  function (data) {

                      // Clear the previous search results
                      while (searchResults.hasChildNodes()) {
                          searchResults.removeChild(searchResults.lastChild);
                      }

                      //Hide or display the search results
                      $(document).ready(function(){

                          $("#hide").click(function(){
                              $("#searchResults").hide();
                          });

                          $("#display").click(function(){
                              $("#searchResults").show();
                          });
                      });
                      dataYT = data.items;
                      dataYT.forEach(function(data){
                          var thumbnailWidth = (searchResults.offsetWidth)*0.15 + 'px';
                          var thumbnailMargin =  (searchResults.offsetWidth)*0.025 + 'px'

                          var thumbnail = document.createElement("img");

                          var thumbnailContainer = document.createElement("div");
                          thumbnailContainer.id = "thumbnailContainer";
                          thumbnailContainer.style.width = thumbnailWidth;

                          thumbnailContainer.style.marginLeft = thumbnailMargin;
                          thumbnailContainer.style.marginRight = thumbnailMargin;

                          thumbnail.style.width = thumbnailWidth;

                          thumbnail.src  = data.snippet.thumbnails.default.url;
                          //var br = document.createElement('br');

                          searchResults.append(thumbnailContainer);
                          thumbnailContainer.append(thumbnail);

                          // Get the number of views
                          var viewCountData;

                          $.get("https://www.googleapis.com/youtube/v3/videos", {
                                  part: 'snippet,contentDetails,statistics',
                                  id: data.id.videoId,
                                  key: 'AIzaSyBY1d9RpLqmieVnW0UjQD2Vahs2thzDsBw'
                          },
                              function (data) {

                                  viewCountData = data.items[0].statistics.viewCount;
                                  var viewCount = document.createElement("div");

                                  function formatViewCountData (num) {
                                      var numLength = num.length;
                                      if(numLength >= 10) {

                                          return (parseFloat(num)/1000000000).toFixed(1) + "B views";

                                      } else if(numLength >= 7) {
                                          return (parseFloat(num)/1000000).toFixed(0) + "M views";

                                      } else if (numLength >= 4) {
                                          return (parseFloat(num)/1000).toFixed(1) + "K views";

                                      } else {
                                          return num + " views";
                                      }
                                  }
                                  viewCount.innerHTML = formatViewCountData(viewCountData) + '';
                                  viewCount.className = "viewCount";
                                  viewCount.style.width = thumbnailWidth;
                                  thumbnailContainer.append(viewCount);

                          });


                          //Users are able to play the videos of their choice
                          function chooseVideo(){
                              player.loadVideoById(data.id.videoId);
                          };
                          thumbnail.addEventListener("click", chooseVideo);

                          var videoTitle = document.createElement('div');
                          parentDiv.append(videoTitle);
                          videoTitle.id = "videoTitle";

                          function showTitle() {
                              videoTitle.innerHTML = '<br>' + data.snippet.title;
                              videoTitle.style.fontSize = "20px";
                          }
                          thumbnail.addEventListener("mouseover", showTitle);

                          function clearTittle() {
                              videoTitle.innerHTML = "";
                          }
                          thumbnail.addEventListener("mouseout", clearTittle);
                      });
                  });
          }
          // Positioning the search bar
          searchBar.style.marginLeft = (parentDiv.offsetWidth - searchBar.offsetWidth)/2 + 'px';

          //Ref: https://stackoverflow.com/questions/8960193/how-to-make-html-element-resizable-using-pure-javascript)
          var resizer = document.createElement("div");
          resizer.id = 'resizer';
          parentDiv.append(resizer);
          resizer.addEventListener('mousedown', initResize, false);

          function initResize(e) {
              window.addEventListener('mousemove', Resize, false);
              window.addEventListener('mouseup', stopResize, false);
          }

          // Resize the parentDiv's size
          // Then the iFrame's size is adjusted accordingly
          function Resize(e) {

              var newWidth = e.clientX - parentDiv.offsetLeft;
              var newHeight = e.clientY - parentDiv.offsetTop;

              parentDiv.style.width = newWidth + 'px';
              parentDiv.style.height = newHeight + 'px';

              player.setSize(newWidth - 10 + 'px', newHeight - 10 + 'px');

              searchBar.style.width = newWidth - 10 + 'px';
              query.style.width = (newWidth - 10)/2 + 'px';

              searchResults.style.width = newWidth - 10 + 'px';

              $("#searchResults").find("*").css("width", (searchResults.offsetWidth - 10)*0.15 + 'px');
              $("#searchResults").find("*").css("marginLeft", (searchResults.offsetWidth - 10)*0.025 + 'px');
              $("#searchResults").find("*").css("marginRight", (searchResults.offsetWidth - 10)*0.025 + 'px');

              grandParentDiv.style.width = parentDiv.offsetWidth + 20 + 'px';
              grandParentDiv.style.height = parentDiv.offsetHeight + searchBar.offsetHeight + searchResults.offsetHeight + 20 + 'px';

          }
          function stopResize(e) {
              window.removeEventListener('mousemove', Resize, false);
              window.removeEventListener('mouseup', stopResize, false);
          }

          //Hover the video to see the search bar
          $(document).ready(function() {
              $("#searchBar").hide();
              $("#searchResults").hide();

              $("#grandParentDiv").hover( function() {
                  $("#searchBar").toggle();
                  $("#searchResults").toggle();
              });

              $("#resizer").hide();
              $("#grandParentDiv").hover(function () {
                  $("#resizer").toggle();
              })
          });

          //Make the grandParentDiv draggable
          dragElement(grandParentDiv);

          function dragElement(elmnt) {
              var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
              if (searchBar) {
                  /* if present, the header is where you move the DIV from:*/
                  searchBar.onmousedown = dragMouseDown;
              } else {
                  /* otherwise, move the DIV from anywhere inside the DIV:*/
                  elmnt.onmousedown = dragMouseDown;
              }

              function dragMouseDown(e) {
                  e = e || window.event;
                  // get the mouse cursor position at startup:
                  pos3 = e.clientX;
                  pos4 = e.clientY;
                  document.onmouseup = closeDragElement;
                  // call a function whenever the cursor moves:
                  document.onmousemove = elementDrag;
              }

              function elementDrag(e) {
                  e = e || window.event;
                  // calculate the new cursor position:
                  pos1 = pos3 - e.clientX;
                  pos2 = pos4 - e.clientY;
                  pos3 = e.clientX;
                  pos4 = e.clientY;
                  // set the element's new position:
                  elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                  elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
              }

              function closeDragElement() {
                  /* stop moving when mouse button is released:*/
                  document.onmouseup = null;
                  document.onmousemove = null;
              }
          }

          // Click SearchButton to generate search results
          searchButton.onclick = searchVideo;

          // Enter to get the search results
          query.addEventListener("keyup", function (event) {
              event.preventDefault();
              if (event.keyCode === 13) {
                  searchButton.click();
              }
          })
          // 4. The API will call this function when the video player is ready.
          function onPlayerReady(event) {
            event.target.playVideo();
          }

          // The API calls this function when the player's state changes.
          // The function indicates that when playing a video (state=1),
          // the player should play for six seconds and then stop.
          var done = false;
          function onPlayerStateChange(event) {
              if (event.data == YT.PlayerState.PLAYING && !done) {
                  setTimeout(stopVideo, 6000);
                  done = true;
            }
          }
          function stopVideo() {
              player.stopVideo();
          }

        </script>
    </body>
</html>
